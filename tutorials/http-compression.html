<!DOCTYPE html>
<html>
<head>
	<title>Canvace</title>
	<link href="http://fonts.googleapis.com/css?family=Titillium+Web:300" rel="stylesheet" type="text/css">
	<link href="/css/screen.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="/pygments.css" rel="stylesheet" type="text/css" />
</head>
<body>

<header class="header">
    Header here
</header>

<a href="https://github.com/canvace"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>

<div class="contents">
<h1 id='http_compression'>HTTP compression</h1>

<p>HTTP compression is a feature typically built into web servers and clients in order to provide better transmission performances. The HTTP data content is compressed before being sent in a format supported by the client. Nowadays, most web servers support HTTP compression, either natively or with some external module. Compression can be quite useful for Canvace, since complex stages may require the transfer of a great amount of data.</p>

<p>In this chapter, we summarize how compression facilities may be configured in the most common webservers: complete guides can be found in the official documentation of each server.</p>

<h2 id='apache'>Apache</h2>

<p>Apache provides the HTTP compression via the <code>mod_deflate</code> module; this module works by installing a DEFLATE filter which compresses the output content before sending it to the client.</p>

<p>First, you need to load the module. Open your httpd.conf and decomment (or add) the line:</p>

<pre><code>LoadModule deflate_module modules/mod_deflate.so</code></pre>

<p>For a simple compression support, just two more lines are needed (in no particular section):</p>

<pre><code>SetOutputFilter DEFLATE
DeflateCompressionLevel 3</code></pre>

<p>The compression level goes from 3 to 9: a higher level results in better compression, but more CPU usage. Setting levels higher than 6 almost never results in an significative performance improvement. The output filter is automatically applied to all kinds of data handled by the server: to restrict its application to a selection of file types, use, for example:</p>

<pre><code>AddOutputFilterByType DEFLATE text/html text/css</code></pre>

<p>Some browsers don&#8217;t support the compression of all file types: in addition to the directive above, you can also control the behavior of the filter according to the browser who sent the request. This is achieved with the <code>BrowserMatch</code> directive.</p>

<h2 id='nodejs'>Node.js</h2>

<p>Compression in Node.js is handled through the <code>zlib</code> module, included by default in the latest releases. The module can be accessed with</p>
<div class='highlight'><pre><code class='javascript'>    <span class='kd'>var</span> <span class='nx'>zlib</span> <span class='o'>=</span> <span class='nx'>require</span><span class='p'>(</span><span class='s1'>&#39;zlib&#39;</span><span class='p'>);</span>
</code></pre></div>
<p>With this object we can compress a file:</p>
<div class='highlight'><pre><code class='javascript'>    <span class='kd'>var</span> <span class='nx'>gzip</span> <span class='o'>=</span> <span class='nx'>zlib</span><span class='p'>.</span><span class='nx'>createGzip</span><span class='p'>();</span>
    <span class='kd'>var</span> <span class='nx'>fs</span> <span class='o'>=</span> <span class='nx'>require</span><span class='p'>(</span><span class='s1'>&#39;fs&#39;</span><span class='p'>);</span>
    <span class='kd'>var</span> <span class='nx'>inp</span> <span class='o'>=</span> <span class='nx'>fs</span><span class='p'>.</span><span class='nx'>createReadStream</span><span class='p'>(</span><span class='s1'>&#39;input.txt&#39;</span><span class='p'>);</span>
    <span class='kd'>var</span> <span class='nx'>out</span> <span class='o'>=</span> <span class='nx'>fs</span><span class='p'>.</span><span class='nx'>createWriteStream</span><span class='p'>(</span><span class='s1'>&#39;input.txt.gz&#39;</span><span class='p'>);</span>
    
    <span class='nx'>inp</span><span class='p'>.</span><span class='nx'>pipe</span><span class='p'>(</span><span class='nx'>gzip</span><span class='p'>).</span><span class='nx'>pipe</span><span class='p'>(</span><span class='nx'>out</span><span class='p'>);</span>
</code></pre></div>
<p>Here gzip is used, but also <code>createDeflate()</code> and <code>createDeflateRaw()</code> are available. Decompression objects can be created with similar methods, for instance <code>createGunzip()</code>. For compression and decompression of generic data, the <code>zlib</code> object provides methods like <code>deflate()</code>, <code>inflate()</code>, <code>gzip()</code>, etc&#8230; all requiring the input buffer as parameter.</p>

<h2 id='nginx'>nginx</h2>

<p>The <code>HttpGzipModule</code> enables on-the-fly compression with gzip. A lot of configuration directives control the behaviour of this module. Here we present the most basic ones:</p>

<pre><code>gzip             on;
gzip_min_length  1024;
gzip_types       text/plain application/xml;
gzip_comp_level  3</code></pre>

<p>The first one enables the module. Next we set the minimum length (in bytes) for data to be compressed, and the mimetypes we want to compress, other than text/html, which is by default taken into account. The compression level can go from 1 to 9: a higher level yields a better compression, but worst performances.</p>

<p>Nginx, since version 0.6.24, also provides the <code>HttpGzipStaticModule</code> for static compression: it will manage pre-compressed versions of files, so that the same files don&#8217;t get compressed over and over.</p>

<h2 id='iis'>IIS</h2>

<p>IIS servers support both static compression (installed by default) and dynamic compression. With the former, compressed content is cached, so that requests for the same compressed file don&#8217;t trigger multiple compression operations. This is useful for files that are almost never modified. On the other hand, dynamic compression is performed at every request, without caching: this is typically used for dynamic content, generated by some application.</p>

<p>The <a href='http://www.iis.net/configreference/system.webserver/httpcompression'>official Microsoft documentation</a> provides all the information for installing compression support through the GUI, and configuring it.</p>
<hr />
</div>

<footer class="footer">
    Footer here
</footer>

</body>
</html>
