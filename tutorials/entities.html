<!DOCTYPE html>
<html>
<head>

	<title>Canvace &bull; Entities and collisions</title>

	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0" />
	<link href="http://fonts.googleapis.com/css?family=Titillium+Web:300" rel="stylesheet" type="text/css">
	<link href="/css/screen.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="/css/mobile.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="/css/pygments.css" rel="stylesheet" type="text/css" media="all" />
	<link href="/favicon.ico" rel="icon" type="image/vnd.microsoft.icon" />
</head>
<body>

<div class="header">
	<div class="inner">
		<a class="logo" href="/"><img src="/media/logo.png" alt="Canvace" /></a>
		<ul class="menu">
			<li><a href="/games/index.html">Games</a></li>
			<li><a href="/tutorials/index.html">Docs</a></li>
			<li><a href="http://api.canvace.com/">API</a></li>
		</ul>
	</div>
</div>

<a href="https://github.com/canvace"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>

<div class="contents">
<ol>
	
		
	
		
	
		
			<li>
				
					<a href='/tutorials/index.html'>Introduction and installation</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/editor.html'>Development environment</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/init.html'>Rendering a stage in the canvas</a>
				
			</li>
		
	
		
			<li>
				
					Entities and collisions
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/pathfinding.html'>Pathfinding and animations</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/input-view.html'>Input events and stage's view</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/effects.html'>Special effects</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/state-machine.html'>State machines</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/sound.html'>Sound effects</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/http-compression.html'>Enabling HTTP compression</a>
				
			</li>
		
	
		
			<li>
				
					<a href='/tutorials/team-working.html'>Teamworking</a>
				
			</li>
		
	
</ol>
<h1 id='entities'>Entities</h1>

<p>Entities are the dynamic components of your game. Typically all the characters in the game are represented as entities. After creating an entity in the development environment, we can retrieve it from the stage it was created into with the <code>getEntity()</code> function, which returns an object of type <code>Canvace.Stage.Entity</code>.</p>

<h2 id='entities_vs_instances'>Entities vs. instances</h2>

<p>Entities are just an abstract description of the component. You may see that the <code>Canvace.Stage.Entity</code> class only stores a quite generic set of properties: for example, you may get the coordinates and span of the bounding box assigned to the entity. Bounding boxes are used by Canvace to easily detect collisions among entities with a great variety of different shapes and sizes.</p>

<p>In order to actually work on the entity inside the game (e.g moving it around) you need to create tangible instances of that entity. A first instance always exists by default: it can be obtained from the <code>Canvace.Stage</code> object, calling the <code>getInstance()</code> method. Other instances can be created and placed on the map with the <code>createInstance()</code> method of <code>Stage.Entity</code>.</p>

<p>Note that entities are filtered in the stage by their custom properties: for this reason, in the development environment we added a custom property &#8220;name&#8221; to all the entities, with a unique value assigned to it.</p>

<p>All instances (even when the physics isn&#8217;t enabled for the correspondent entity) may evolve, during the progress of the game, according to the physics rules implemented by Canvace. More specifically, each entity stores the following physics-related properties:</p>

<ul>
<li>position</li>

<li>velocity</li>

<li>uniform velocity</li>

<li>acceleration These properties are vectors in a 3-dimensional space. By modifying these vectors it is possible to move the instance around the map: at each rendering loop, the entity&#8217;s physics state is changed according to the vectors, and then the actual position of the instance is updated. You don&#8217;t need to control this process manually: the pathfinding chapter of this tutorial explains how you can use interpolated animations to let Canvace do the job for you.</li>
</ul>

<h2 id='collisions'>Collisions</h2>

<p>Canvace is equipped with features for testing and reacting to collisions. An entity may collide with other entities or with tiles.</p>
<div class='highlight'><pre><code class='javascript'>    <span class='k'>if</span> <span class='p'>(</span><span class='nx'>enemy1</span><span class='p'>.</span><span class='nx'>collidesWithInstance</span><span class='p'>(</span><span class='nx'>enemy2</span><span class='p'>))</span> <span class='p'>{</span>
        <span class='nx'>enemy1</span><span class='p'>.</span><span class='nx'>collision</span><span class='p'>(</span><span class='nx'>enemy2</span><span class='p'>);</span>
    <span class='p'>}</span>
</code></pre></div>
<p>Here, for example, after we moved all the characters by one step in their current paths, we check whether two instances of enemies, enemy1 and enemy2, are colliding. The <code>collidesWithInstance()</code> method performs this test, while <code>collision()</code> tries to restore non-colliding configurations for both. Usually this means the instances briefly move away from each other until a safety condition is met. Collisions with tiles work in a similar way: <code>collidesWithTiles()</code> needs the <code>Canvace.TileMap.Tile</code> object retrieved from the stage&#8217;s tilemap.</p>

<h2 id='replacing_and_removing_entities'>Replacing and removing entities</h2>

<p>Once an entity instance has been instantiated, it is possible to change its external appearance by replacing it with an instance of another entity who had a different frame associated to it. This second entity, of course, must have been created and exported from the editor as usual.</p>

<p>In the game, for example, we replace the instance of the main character when it collides with a donut (represented by another instance). First, we retrieve the second entity from the stage using the custom property &#8220;name&#8221; as filter:</p>
<div class='highlight'><pre><code class='javascript'>    <span class='kd'>var</span> <span class='nx'>immortalMan</span> <span class='o'>=</span> <span class='nx'>stage</span><span class='p'>.</span><span class='nx'>getEntity</span><span class='p'>({</span> <span class='nx'>name</span><span class='o'>:</span> <span class='s2'>&quot;Stealth&quot;</span> <span class='p'>});</span>
</code></pre></div>
<p>As soon as we detect the collision, the following line performs the replacement:</p>
<div class='highlight'><pre><code class='javascript'>    <span class='nx'>protagonist</span><span class='p'>.</span><span class='nx'>instance</span> <span class='o'>=</span> <span class='nx'>protagonist</span><span class='p'>.</span><span class='nx'>instance</span><span class='p'>.</span><span class='nx'>replaceWith</span><span class='p'>(</span><span class='nx'>immortalMan</span><span class='p'>);</span>
</code></pre></div>
<p>Note that once the replacement took place, the new instance is immediately created and returned, while the old instance isn&#8217;t valid anymore, and should be discarded (here, we simply overwrite it with the new one). The new instance also shares all the physics-related information of the old one, i.e. the position, velocity and acceleration vectors. Thus, if the old instance was following a path, the new one will continue to do so. It&#8217;s also possible to completely remove an entity&#8217;s instance from the stage. After the character has been replaced as above, the donut is removed from the map:</p>
<div class='highlight'><pre><code class='javascript'>    <span class='nx'>donut</span><span class='p'>.</span><span class='nx'>remove</span><span class='p'>();</span>
</code></pre></div>
<p>After that call, the instance won&#8217;t be rendered anymore.</p>
<hr />


<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'canvace';

	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>

<div class="footer">
	<div class="inner">
		<div>
			Canvace Srl - Via Luigi Casale, 7 - 05100 Terni (Italia) - VAT/P. IVA 01485160558
			&nbsp;
			<a href="https://www.iubenda.com/privacy-policy/863492" class="iubenda-black iubenda-embed" title="Privacy Policy">Privacy Policy</a>
		</div>
		<script type="text/javascript">(function (w,d) {var loader = function () {var s = d.createElement("script"), tag = d.getElementsByTagName("script")[0]; s.src = "https://cdn.iubenda.com/iubenda.js"; tag.parentNode.insertBefore(s,tag);}; if(w.addEventListener){w.addEventListener("load", loader, false);}else if(w.attachEvent){w.attachEvent("onload", loader);}else{w.onload = loader;}})(window, document);</script>
		<div>
			<a href="http://enlabs.it/" target="_blank"><img src="/media/enlabs.png" alt="Powered by EnLabs" /></a>
		</div>
	</div>
</div>

</body>
</html>
